<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA Analysis Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .dashboard {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--gradient-1);
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: scaleIn 0.5s ease-out backwards;
        }

        .metric-card:nth-child(1) { animation-delay: 0.1s; }
        .metric-card:nth-child(2) { animation-delay: 0.2s; }
        .metric-card:nth-child(3) { animation-delay: 0.3s; }
        .metric-card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
            border-color: var(--primary-color);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-1);
        }

        .metric-card.gradient-2::before { background: var(--gradient-2); }
        .metric-card.gradient-3::before { background: var(--gradient-3); }
        .metric-card.gradient-4::before { background: var(--gradient-4); }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .metric-card.gradient-2 .metric-value { background: var(--gradient-2); }
        .metric-card.gradient-3 .metric-value { background: var(--gradient-3); }
        .metric-card.gradient-4 .metric-value { background: var(--gradient-4); }

        .metric-change {
            font-size: 0.875rem;
            color: var(--success-color);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            animation: slideUp 0.7s ease-out backwards;
        }

        .chart-card:nth-child(1) { animation-delay: 0.5s; }
        .chart-card:nth-child(2) { animation-delay: 0.6s; }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        canvas {
            max-width: 100%;
            height: auto !important;
        }

        .course-table-container {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease-out backwards;
            animation-delay: 0.7s;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .filter-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .course-table {
            width: 100%;
            overflow-x: auto;
        }

        .course-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .course-table th {
            text-align: left;
            padding: 1rem;
            background: var(--dark-bg);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--border-color);
        }

        .course-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .course-table tbody tr {
            transition: all 0.3s ease;
        }

        .course-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .grade-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .grade-A { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .grade-B { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .grade-C { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .grade-D { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .attribute-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .attribute-required {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }

        .attribute-elective {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .file-upload-area {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            border: 2px dashed var(--border-color);
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .file-upload-label {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-label:hover {
            background: #5558e3;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .dashboard {
                padding: 1rem;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                width: 100%;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>ğŸ“Š GPA æˆç»©åˆ†æä»ªè¡¨æ¿</h1>
            <div class="subtitle">Finance Major â€¢ Technical Approach â€¢ Real-time Analysis</div>
        </div>

        <!-- File Upload Area -->
        <div class="file-upload-area" id="upload-area">
            <p style="margin-bottom: 1rem; color: var(--text-secondary);">ğŸ“ è¯·é€‰æ‹©ä½ çš„ courses.csv æ–‡ä»¶</p>
            <label for="file-input" class="file-upload-label">
                é€‰æ‹©æ–‡ä»¶
            </label>
            <input type="file" id="file-input" accept=".csv">
            <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-secondary);" id="file-status">æœªé€‰æ‹©æ–‡ä»¶</p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">ç´¯è®¡ GPA</div>
                <div class="metric-value" id="overall-gpa">--</div>
                <div class="metric-change" id="gpa-trend">ç­‰å¾…æ•°æ®...</div>
            </div>
            <div class="metric-card gradient-2">
                <div class="metric-label">æ€»å­¦åˆ†</div>
                <div class="metric-value" id="total-credits">--</div>
                <div class="metric-change">å·²ä¿®è¯»è¯¾ç¨‹</div>
            </div>
            <div class="metric-card gradient-3">
                <div class="metric-label">è¯¾ç¨‹æ€»æ•°</div>
                <div class="metric-value" id="total-courses">--</div>
                <div class="metric-change">åŒ…å«å¿…ä¿®ä¸é€‰ä¿®</div>
            </div>
            <div class="metric-card gradient-4">
                <div class="metric-label">é€šè¿‡ç‡</div>
                <div class="metric-value" id="pass-rate">--</div>
                <div class="metric-change">ä¼˜ç§€è¡¨ç°</div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-card">
                <h3 class="chart-title">å­¦æœŸ GPA è¶‹åŠ¿</h3>
                <div class="chart-container">
                    <canvas id="gpa-trend-chart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">æˆç»©åˆ†å¸ƒ</h3>
                <div class="chart-container">
                    <canvas id="grade-distribution-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="course-table-container">
            <div class="table-header">
                <h3 class="chart-title">è¯¾ç¨‹è¯¦æƒ…</h3>
                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="search-input" placeholder="æœç´¢è¯¾ç¨‹åç§°æˆ–ä»£ç ...">
                </div>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="required">å¿…ä¿®</button>
                <button class="filter-btn" data-filter="elective">é€‰ä¿®</button>
                <button class="filter-btn" data-filter="passed">å·²é€šè¿‡</button>
            </div>
            <div class="course-table">
                <table>
                    <thead>
                        <tr>
                            <th>è¯¾ç¨‹åç§°</th>
                            <th>è¯¾ç¨‹ä»£ç </th>
                            <th>å­¦æœŸ</th>
                            <th>å±æ€§</th>
                            <th>å­¦åˆ†</th>
                            <th>æˆç»©</th>
                            <th>ç»©ç‚¹</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="course-tbody">
                        <tr>
                            <td colspan="8" class="no-data">è¯·ä¸Šä¼  CSV æ–‡ä»¶å¼€å§‹åˆ†æ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Global variables
        let coursesData = [];
        let currentFilter = 'all';
        let gpaTrendChart = null;
        let gradeDistChart = null;

        // File upload handler
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'text/csv') {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const csvText = event.target.result;
                    try {
                        coursesData = parseCSV(csvText);
                        document.getElementById('file-status').textContent = `å·²åŠ è½½: ${file.name}`;
                        document.getElementById('upload-area').style.display = 'none';
                        initDashboard();
                    } catch (error) {
                        console.error('Error parsing CSV:', error);
                        alert('CSV æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    }
                };
                reader.readAsText(file, 'UTF-8');
            } else {
                alert('è¯·é€‰æ‹©ä¸€ä¸ª CSV æ–‡ä»¶');
            }
        });

        // Try to read file using window.fs if available (for Claude environment)
        async function tryReadFile() {
            if (typeof window !== 'undefined' && window.fs && window.fs.readFile) {
                try {
                    const response = await window.fs.readFile('courses.csv', { encoding: 'utf8' });
                    coursesData = parseCSV(response);
                    document.getElementById('upload-area').style.display = 'none';
                    initDashboard();
                } catch (error) {
                    console.log('No file found in environment, waiting for upload');
                }
            }
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    let value = values[index]?.trim();
                    // Type conversion
                    if (header === 'course_weight') {
                        value = parseFloat(value) || 0;
                    } else if (header === 'course_gpa') {
                        value = value === '--' ? null : parseFloat(value) || null;
                    } else if (header === 'course_semester') {
                        value = isNaN(value) ? value : parseInt(value);
                    } else if (header === 'course_score') {
                        value = isNaN(value) ? value : parseFloat(value);
                    }
                    row[header] = value;
                });
                data.push(row);
            }
            
            return data;
        }

        // Initialize dashboard
        function initDashboard() {
            updateMetrics();
            createGPATrendChart();
            createGradeDistributionChart();
            populateCourseTable();
            setupEventListeners();
        }

        // Update dashboard metrics
        function updateMetrics() {
            // Calculate overall GPA
            const validGPAs = coursesData.filter(c => c.course_gpa !== null && c.course_gpa !== undefined);
            const totalWeightedGPA = validGPAs.reduce((sum, c) => sum + (c.course_gpa * c.course_weight), 0);
            const totalWeight = validGPAs.reduce((sum, c) => sum + c.course_weight, 0);
            const overallGPA = totalWeight > 0 ? (totalWeightedGPA / totalWeight).toFixed(2) : '0.00';
            
            // Calculate other metrics
            const totalCredits = coursesData.reduce((sum, c) => sum + (c.course_weight || 0), 0);
            const totalCourses = coursesData.length;
            const passedCourses = coursesData.filter(c => c.pass === 'passed').length;
            const passRate = totalCourses > 0 ? ((passedCourses / totalCourses) * 100).toFixed(1) : '0';
            
            // Update DOM with animation
            animateValue('overall-gpa', 0, parseFloat(overallGPA), 1000);
            animateValue('total-credits', 0, totalCredits, 1000);
            animateValue('total-courses', 0, totalCourses, 1000);
            animateValue('pass-rate', 0, parseFloat(passRate), 1000, '%');
            
            // Update GPA trend indicator
            const gpaTrend = document.getElementById('gpa-trend');
            if (overallGPA >= 3.5) {
                gpaTrend.innerHTML = 'ğŸ“ˆ ä¼˜ç§€æ°´å¹³';
                gpaTrend.style.color = '#10b981';
            } else if (overallGPA >= 3.0) {
                gpaTrend.innerHTML = 'ğŸ“Š è‰¯å¥½æ°´å¹³';
                gpaTrend.style.color = '#3b82f6';
            } else {
                gpaTrend.innerHTML = 'ğŸ“‰ ç»§ç»­åŠªåŠ›';
                gpaTrend.style.color = '#f59e0b';
            }
        }

        // Animate number changes
        function animateValue(id, start, end, duration, suffix = '') {
            const element = document.getElementById(id);
            if (!element) return;
            
            const range = end - start;
            const minTimer = 50;
            let stepTime = Math.abs(Math.floor(duration / range));
            stepTime = Math.max(stepTime, minTimer);
            
            const startTime = new Date().getTime();
            const endTime = startTime + duration;
            let timer;
            
            function run() {
                const now = new Date().getTime();
                const remaining = Math.max((endTime - now) / duration, 0);
                const value = end - (remaining * range);
                
                if (value == end) {
                    clearInterval(timer);
                }
                
                element.textContent = value.toFixed(value % 1 === 0 ? 0 : 2) + suffix;
            }
            
            timer = setInterval(run, stepTime);
            run();
        }

        // Create GPA trend chart
        function createGPATrendChart() {
            const ctx = document.getElementById('gpa-trend-chart').getContext('2d');
            
            // Destroy existing chart if exists
            if (gpaTrendChart) {
                gpaTrendChart.destroy();
            }
            
            // Process semester data
            const semesterGPAs = {};
            const semesterCredits = {};
            
            coursesData.forEach(course => {
                const semester = course.course_semester;
                if (semester && typeof semester === 'number' && course.course_gpa !== null) {
                    if (!semesterGPAs[semester]) {
                        semesterGPAs[semester] = 0;
                        semesterCredits[semester] = 0;
                    }
                    semesterGPAs[semester] += course.course_gpa * course.course_weight;
                    semesterCredits[semester] += course.course_weight;
                }
            });
            
            const semesters = Object.keys(semesterGPAs).map(Number).sort((a, b) => a - b);
            const gpas = semesters.map(sem => 
                semesterCredits[sem] > 0 ? parseFloat((semesterGPAs[sem] / semesterCredits[sem]).toFixed(2)) : 0
            );
            
            // Calculate cumulative GPA
            let cumulativeGPA = [];
            let totalWeight = 0;
            let totalGPA = 0;
            
            semesters.forEach(sem => {
                totalGPA += semesterGPAs[sem];
                totalWeight += semesterCredits[sem];
                cumulativeGPA.push(parseFloat((totalGPA / totalWeight).toFixed(2)));
            });
            
            gpaTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: semesters.map(s => `ç¬¬${s}å­¦æœŸ`),
                    datasets: [{
                        label: 'å­¦æœŸ GPA',
                        data: gpas,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#6366f1',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }, {
                        label: 'ç´¯è®¡ GPA',
                        data: cumulativeGPA,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        borderDash: [5, 5],
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#94a3b8',
                                font: { size: 12 },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.95)',
                            padding: 12,
                            cornerRadius: 8,
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4.0,
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 11 }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 11 }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Create grade distribution chart
        function createGradeDistributionChart() {
            const ctx = document.getElementById('grade-distribution-chart').getContext('2d');
            
            // Destroy existing chart if exists
            if (gradeDistChart) {
                gradeDistChart.destroy();
            }
            
            // Count grades
            const gradeCount = { A: 0, B: 0, C: 0, D: 0, F: 0 };
            
            coursesData.forEach(course => {
                const gpa = course.course_gpa;
                if (gpa !== null && gpa !== undefined) {
                    if (gpa >= 3.7) gradeCount.A++;
                    else if (gpa >= 2.7) gradeCount.B++;
                    else if (gpa >= 1.7) gradeCount.C++;
                    else if (gpa >= 1.0) gradeCount.D++;
                    else gradeCount.F++;
                }
            });
            
            gradeDistChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['A (â‰¥3.7)', 'B (â‰¥2.7)', 'C (â‰¥1.7)', 'D (â‰¥1.0)', 'F (<1.0)'],
                    datasets: [{
                        data: [gradeCount.A, gradeCount.B, gradeCount.C, gradeCount.D, gradeCount.F],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(107, 114, 128, 0.8)'
                        ],
                        borderColor: [
                            '#10b981',
                            '#3b82f6',
                            '#f59e0b',
                            '#ef4444',
                            '#6b7280'
                        ],
                        borderWidth: 2,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#94a3b8',
                                font: { size: 12 },
                                padding: 15,
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label}: ${data.datasets[0].data[i]}é—¨`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        strokeStyle: data.datasets[0].borderColor[i],
                                        lineWidth: 2,
                                        hidden: false,
                                        index: i
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.95)',
                            padding: 12,
                            cornerRadius: 8,
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0';
                                    return `${label}: ${value}é—¨ (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Populate course table
        function populateCourseTable(filterType = 'all', searchTerm = '') {
            const tbody = document.getElementById('course-tbody');
            let filteredCourses = [...coursesData];
            
            // Apply filters
            if (filterType === 'required') {
                filteredCourses = filteredCourses.filter(c => c.course_attribute === 'å¿…ä¿®');
            } else if (filterType === 'elective') {
                filteredCourses = filteredCourses.filter(c => c.course_attribute === 'é€‰ä¿®');
            } else if (filterType === 'passed') {
                filteredCourses = filteredCourses.filter(c => c.pass === 'passed');
            }
            
            // Apply search
            if (searchTerm) {
                filteredCourses = filteredCourses.filter(c => 
                    (c.course_name && c.course_name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (c.course_code && c.course_code.toString().toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }
            
            // Generate table HTML
            if (filteredCourses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="no-data">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯¾ç¨‹</td></tr>';
                return;
            }
            
            tbody.innerHTML = filteredCourses.map(course => {
                const gradeClass = getGradeClass(course.course_gpa);
                const attributeClass = course.course_attribute === 'å¿…ä¿®' ? 'attribute-required' : 'attribute-elective';
                
                return `
                    <tr>
                        <td>${course.course_name || '--'}</td>
                        <td>${course.course_code || '--'}</td>
                        <td>${course.course_semester || '--'}</td>
                        <td><span class="attribute-badge ${attributeClass}">${course.course_attribute || '--'}</span></td>
                        <td>${course.course_weight || '--'}</td>
                        <td><span class="grade-badge ${gradeClass}">${course.course_score || '--'}</span></td>
                        <td>${course.course_gpa !== null ? course.course_gpa : '--'}</td>
                        <td>${course.pass === 'passed' ? 'âœ… é€šè¿‡' : 'âŒ æœªé€šè¿‡'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Get grade class for styling
        function getGradeClass(gpa) {
            if (gpa === null || gpa === undefined) return '';
            if (gpa >= 3.7) return 'grade-A';
            if (gpa >= 2.7) return 'grade-B';
            if (gpa >= 1.7) return 'grade-C';
            return 'grade-D';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    const searchTerm = document.getElementById('search-input').value;
                    populateCourseTable(currentFilter, searchTerm);
                });
            });
            
            // Search input
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    populateCourseTable(currentFilter, this.value);
                }, 300);
            });
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            tryReadFile();
        });
    </script>
</body>
</html>